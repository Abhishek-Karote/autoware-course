# Lecture 04: Platform (ECUs, RTOS, and DDS)
[![Autoware.Auto badge](https://img.shields.io/badge/Autoware-Auto-orange.svg)](https://www.autoware.auto)

This lecture is provided by [Stephane Strahm](https://www.linkedin.com/in/stephanestrahm/), Product Manager at Kalray, and by [Angelo Corsaro](https://www.linkedin.com/in/corsaro/), from AD-Link. The lecture is available in YouTube:

[![Lecture video](https://img.youtube.com/vi/IyycN6ldsIs/0.jpg)](https://www.youtube.com/watch?v=IyycN6ldsIs&list=PLL57Sz4fhxLpCXgN0lvCF7aHAlRA5FoFr&index=4)

The target will be to cover the underlying technologies under the systems that run Autoware.Auto and ROS 2. The **first part** will include three topics: (1) Electronic Control Units (ECUs), (2) Real Time Operating Systems (RTOS), and (3) design and optimization criterias. Next, the **second part** will cover ROS 2's middleware, Data Distribution Service (DDS).

The provided PDFs can be found in the Apex.AI's [autowareclass2020 repository](https://gitlab.com/ApexAI/autowareclass2020/-/blob/master/lectures/04_Platform), in GitLab. There is one for the [first](https://gitlab.com/ApexAI/autowareclass2020/-/blob/master/lectures/04_Platform/ECUandRTOS.pdf) and another for the [second](https://gitlab.com/ApexAI/autowareclass2020/-/blob/master/lectures/04_Platform/DDSExplained.pdf) part of the lecture.


## [4.1. Electronic Control Units (ECUs)](https://youtu.be/IyycN6ldsIs?t=75)
In a [SAE Level 2](https://www.sae.org/news/2019/01/sae-updates-j3016-automated-driving-graphic) vehicle, more than 80 ECUs can be found, destinated to control systems such as the audio, video, navigation, motor control, Advanced Driving Assitance System (ADAS), Autonomous Driving (AD), etc. This number has been increased as new features and technologies were introduced in vehicles, which increased both the complexity of the system and the concerns about the safety. In this lecture, we will focus on ADAS and AD ECUs. The ADAS one will assist the driver monitoring its speed, using sensors during parking, alert of the presence of radars or other vehicles nearby, etc. All these things while the driver remain in control of the vehicle. The AD ECU will make the vehicle able to be driven by itself.

The **ADAS and AD ECU functions** can be classified in four different groups:

- **Sensors** such as cameras, GPS, RADAR or LIDAR. This module is in charge of gathering data about the vehicle's environment. This data will be forwarded to the perception module. By combining data from these sensors, a more reliable and robust system is achieved.
- **Perception**: Its task is to process the data obtained with the sensors to generate higher-level information. Some ways of doing so is using localization, tracking, detection, classification and/or segmentation techniques.
- **Planning**: With the knowledge generated by the perception module, the planning one will decide which behaviour to perform and compute a trajectory that implements it. It is also in charge of planning long/global routes and usually tries to predict the behaviour of the other elements around the vehicle to plan safe actions.
- **Control**: Once knowing where and how the vehicle must move, the control module will manage the engine, steering wheel, brakes and other systems to reach the targets in optimal ways.

### [4.1.1. Automotive ECUs](https://youtu.be/IyycN6ldsIs?t=655)
Automotive ECUs will require different **components**. The main will be:

- **Inputs and outputs** to connect the sensors and actuators so that they can be used by the ECU.
- **Application processors**: To fuse the data from the sensors and perform the planning and control. Specific processors may be needed to work with specific types of data, such as Digital Singal Processors (DSPs) for signals, others for visual information, etc. They are powerful components, both x86 and ARM are used.
- **Accellerator units**: Some heavy computation may be needed for, for examples, running CNNs or heavy mathematical algorithms. Today, those heavy calculations are usually done solved with GPUs.
- **Safety processors**: Given how critical the automotive applications are, it is essential to have fully reliable systems. This is why there are processors used exclusively for safety-related tasks, which are monitoring the overall system. Appart of this, the [ISO 26262](https://www.iso.org/obp/ui/#iso:std:iso:26262:-2:ed-2:v1:en) defines development and verification processes that must be followed to ensure the required safety level specified by the [Automotive Safety Integrity Level (ASIL)](https://www.synopsys.com/automotive/what-is-asil.html) levels.

The big ammount of required functions and the extense history and evolution has left us with a large spectrum of boards and chips. A few of them are the [Kalray products](https://www.kalrayinc.com/products/), the NXP's [BlueBox](https://www.nxp.com/design/development-boards/automotive-development-platforms/nxp-bluebox-autonomous-driving-development-platform:BLBX) and [S32G](https://www.nxp.com/products/processors-and-microcontrollers/arm-processors/s32-automotive-platform/s32g-processors-for-vehicle-networking:S32G274A)], the [Tesla's AD board](https://www.theverge.com/2019/4/22/18511594/tesla-new-self-driving-chip-is-here-and-this-is-your-best-look-yet), the [Infineron](https://www.infineon.com/cms/en/) safety processors or the [NVIDIA options](https://www.nvidia.com/en-us/self-driving-cars). There are many options for production, pre-production and development that are constantly evolving thanks to the revolutions introduced by tier 1 or Original Equipment Manufacturers (OEMs).

### [4.1.2. Supporting Software for ECUs](https://youtu.be/IyycN6ldsIs?t=975)
To have all these functions runing, abstraction levels are adopted in the software of the ECUs. These levels will be:

- **Hardware**: Composed by application and safety processors and accelerators.
- **Operating System** (and its kernel) that exposes these HW features.
- **User services** such as libraries, drivers or Board Support Packages (BSPs), that contains ECU-specific drivers so that an RTOS can run on it.
- **Protocols and communications** such as DDS, ROS, etc. The applications will also rely on POSIX to communicate with libraries and other features below them.
- **Applications** will run on top of all the components described before.


## [4.2. Real-Time Operating Systems (RTOSs)](https://youtu.be/IyycN6ldsIs?t=1115)
### 4.2.1. RTOS in Comparison to Linux
- Suitable RTOSs for Autonomous Driving (AD)

### 4.2.2. Micro vs Monolithic Kernel

### 4.2.3. Policy Scheduling

### 4.2.4. Safe Memory Management
- Spatial and Temporal Separation

### 4.2.5. Support for HW Acceleration


## 4.3. Data Distribution Service (DDS)
### 4.3.1. DDS Foundations

### 4.3.2. Advanced DDS Concepts

### 4.3.3. DDS Features for Robotic Applications


